<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Post New Job - Elevate Workforce Solutions</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 25%, #d299c2 50%, #fef9d7 75%, #89f7fe 100%);
            min-height: 100vh;
            font-family: 'Poppins', sans-serif;
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 30% 30%, rgba(168, 237, 234, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 70% 70%, rgba(254, 214, 227, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 50% 50%, rgba(137, 247, 254, 0.2) 0%, transparent 50%);
            animation: backgroundShift 12s ease-in-out infinite;
            z-index: -1;
        }

        @keyframes backgroundShift {
            0%, 100% { transform: rotate(0deg) scale(1); }
            33% { transform: rotate(120deg) scale(1.1); }
            66% { transform: rotate(240deg) scale(0.9); }
        }

        .navbar {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
            backdrop-filter: blur(20px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            padding: 1rem 0;
        }

        .navbar-brand {
            font-weight: 700;
            font-size: 1.8rem;
            color: #fff !important;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .nav-link {
            color: rgba(255, 255, 255, 0.9) !important;
            font-weight: 500;
            margin: 0 0.5rem;
            padding: 0.5rem 1rem !important;
            border-radius: 25px;
            transition: all 0.3s ease;
        }

        .nav-link:hover {
            background: rgba(255, 255, 255, 0.2);
            color: #fff !important;
            transform: translateY(-2px);
        }

        .page-header {
            text-align: center;
            padding: 2rem 0;
            margin-bottom: 2rem;
        }

        .page-header h1 {
            font-size: 3rem;
            font-weight: 700;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.5rem;
        }

        .page-header p {
            font-size: 1.2rem;
            color: #6c757d;
            font-weight: 500;
        }

        .card {
            border: none;
            border-radius: 30px;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(20px);
            background: rgba(255, 255, 255, 0.95);
            overflow: hidden;
            position: relative;
            animation: slideUp 0.8s ease-out;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 6px;
            background: linear-gradient(90deg, #a8edea, #fed6e3, #d299c2, #fef9d7, #89f7fe);
        }

        .card-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
            color: white;
            border: none;
            padding: 2rem;
            text-align: center;
        }

        .card-header h4 {
            font-size: 1.8rem;
            font-weight: 700;
            margin: 0;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
        }

        .card-body {
            padding: 3rem 2.5rem;
        }

        .form-section {
            background: linear-gradient(135deg, #f8f9ff 0%, #fff5f5 100%);
            border-radius: 20px;
            padding: 2rem;
            margin-bottom: 2rem;
            border-left: 5px solid #667eea;
            position: relative;
        }

        .form-section::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 100px;
            height: 100px;
            background: radial-gradient(circle, rgba(102, 126, 234, 0.1) 0%, transparent 70%);
            border-radius: 50%;
        }

        .section-title {
            font-size: 1.3rem;
            font-weight: 700;
            color: #667eea;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
        }

        .section-title i {
            margin-right: 0.5rem;
            font-size: 1.5rem;
        }

        .form-label {
            font-weight: 600;
            color: #495057;
            margin-bottom: 0.5rem;
            font-size: 1rem;
        }

        .required {
            color: #e74c3c;
            font-weight: 700;
        }

        .form-control, .form-select {
            border-radius: 15px;
            border: 2px solid #e9ecef;
            padding: 15px 20px;
            font-weight: 500;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.9);
        }

        .form-control:focus, .form-select:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
            background: rgba(255, 255, 255, 1);
            transform: translateY(-2px);
        }

        .form-control::placeholder {
            color: #adb5bd;
            font-style: italic;
        }

        textarea.form-control {
            resize: vertical;
            min-height: 120px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            border-radius: 50px;
            padding: 15px 35px;
            font-weight: 700;
            font-size: 1.1rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.3s ease;
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
            position: relative;
            overflow: hidden;
        }

        .btn-primary::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.5s;
        }

        .btn-primary:hover::before {
            left: 100%;
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 35px rgba(102, 126, 234, 0.6);
            background: linear-gradient(135deg, #764ba2 0%, #667eea 100%);
        }

        .btn-success {
            background: linear-gradient(135deg, #00b894 0%, #00a085 100%);
            border: none;
            border-radius: 50px;
            padding: 15px 35px;
            font-weight: 700;
            font-size: 1.1rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.3s ease;
            box-shadow: 0 8px 25px rgba(0, 184, 148, 0.4);
        }

        .btn-success:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 35px rgba(0, 184, 148, 0.6);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #636e72 0%, #2d3436 100%);
            border: none;
            border-radius: 50px;
            padding: 15px 35px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn-secondary:hover {
            transform: translateY(-2px);
            background: linear-gradient(135deg, #2d3436 0%, #636e72 100%);
        }

        .alert {
            border: none;
            border-radius: 15px;
            padding: 1.5rem;
            font-weight: 500;
            margin-bottom: 2rem;
            animation: slideIn 0.5s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .alert-danger {
            background: linear-gradient(135deg, #fd79a8 0%, #e84393 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(253, 121, 168, 0.3);
        }

        .job-type-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 0.5rem;
        }

        .job-type-option {
            position: relative;
        }

        .job-type-option input[type="radio"] {
            display: none;
        }

        .job-type-option label {
            display: block;
            padding: 1rem;
            border: 2px solid #e9ecef;
            border-radius: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
            font-weight: 600;
        }

        .job-type-option input[type="radio"]:checked + label {
            border-color: #667eea;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        }

        .job-type-option i {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
            display: block;
        }

        .form-actions {
            background: linear-gradient(135deg, #f8f9ff 0%, #fff5f5 100%);
            border-radius: 20px;
            padding: 2rem;
            margin-top: 2rem;
            text-align: center;
        }

        .character-counter {
            font-size: 0.85rem;
            color: #6c757d;
            text-align: right;
            margin-top: 0.5rem;
        }

        .floating-help {
            position: fixed;
            bottom: 30px;
            left: 30px;
            z-index: 1000;
            background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%);
            color: white;
            border: none;
            border-radius: 50px;
            padding: 15px 20px;
            box-shadow: 0 4px 15px rgba(116, 185, 255, 0.4);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        @media (max-width: 768px) {
            .page-header h1 {
                font-size: 2rem;
            }
            
            .card-body {
                padding: 2rem 1.5rem;
            }
            
            .form-section {
                padding: 1.5rem;
            }
            
            .job-type-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
        <div class="container">
            <a class="navbar-brand" href="/jobs">
                <i class="fas fa-briefcase me-2"></i>Elevate Workforce
            </a>
            
            <div class="navbar-nav ms-auto">
                <a class="nav-link" href="/company/dashboard">
                    <i class="fas fa-tachometer-alt me-1"></i>Dashboard
                </a>
                <a class="nav-link" href="/auth/logout">
                    <i class="fas fa-user me-1"></i><%= user.name %> - Logout
                </a>
            </div>
        </div>
    </nav>

    <div class="container" style="margin-top: 100px;">
        <!-- Page Header -->
        <div class="page-header">
            <h1><i class="fas fa-plus-circle me-3"></i>Post New Job</h1>
            <p>Create an amazing job listing to attract the best talent</p>
        </div>

        <div class="row justify-content-center">
            <div class="col-lg-10">
                <div class="card">
                    <div class="card-header">
                        <h4><i class="fas fa-rocket me-2"></i>Create Your Job Listing</h4>
                    </div>
                    <div class="card-body">
                        <% if (errors.length > 0) { %>
                            <div class="alert alert-danger">
                                <i class="fas fa-exclamation-triangle me-2"></i>
                                <strong>Please fix the following errors:</strong>
                                <ul class="mb-0 mt-2 list-unstyled">
                                    <% errors.forEach(error => { %>
                                        <li><i class="fas fa-times me-1"></i><%= error.msg %></li>
                                    <% }); %>
                                </ul>
                            </div>
                        <% } %>

                        <form method="POST" action="/company/jobs/create" id="jobForm">
                            <!-- Basic Information -->
                            <div class="form-section">
                                <h5 class="section-title">
                                    <i class="fas fa-info-circle"></i>Basic Information
                                </h5>
                                
                                <div class="row">
                                    <div class="col-md-8">
                                        <div class="mb-3">
                                            <label for="title" class="form-label">
                                                Job Title <span class="required">*</span>
                                            </label>
                                            <input type="text" class="form-control" id="title" name="title" 
                                                   value="<%= formData.title || '' %>" required 
                                                   placeholder="e.g. Senior Software Developer, Marketing Manager">
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="mb-3">
                                            <label class="form-label">
                                                Job Type <span class="required">*</span>
                                            </label>
                                            <div class="job-type-grid">
                                                <div class="job-type-option">
                                                    <input type="radio" id="full_time" name="job_type" value="full_time" 
                                                           <%= formData.job_type === 'full_time' ? 'checked' : '' %>>
                                                    <label for="full_time">
                                                        <i class="fas fa-clock"></i>
                                                        Full Time
                                                    </label>
                                                </div>
                                                <div class="job-type-option">
                                                    <input type="radio" id="part_time" name="job_type" value="part_time" 
                                                           <%= formData.job_type === 'part_time' ? 'checked' : '' %>>
                                                    <label for="part_time">
                                                        <i class="fas fa-clock-o"></i>
                                                        Part Time
                                                    </label>
                                                </div>
                                                <div class="job-type-option">
                                                    <input type="radio" id="contract" name="job_type" value="contract" 
                                                           <%= formData.job_type === 'contract' ? 'checked' : '' %>>
                                                    <label for="contract">
                                                        <i class="fas fa-handshake"></i>
                                                        Contract
                                                    </label>
                                                </div>
                                                <div class="job-type-option">
                                                    <input type="radio" id="internship" name="job_type" value="internship" 
                                                           <%= formData.job_type === 'internship' ? 'checked' : '' %>>
                                                    <label for="internship">
                                                        <i class="fas fa-graduation-cap"></i>
                                                        Internship
                                                    </label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label for="location" class="form-label">
                                                <i class="fas fa-map-marker-alt me-1"></i>
                                                Location <span class="required">*</span>
                                            </label>
                                            <input type="text" class="form-control" id="location" name="location" 
                                                   value="<%= formData.location || '' %>" required 
                                                   placeholder="e.g. Kathmandu, Nepal or Remote">
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label for="salary_range" class="form-label">
                                                <i class="fas fa-money-bill-wave me-1"></i>
                                                Salary Range
                                            </label>
                                            <input type="text" class="form-control" id="salary_range" name="salary_range" 
                                                   value="<%= formData.salary_range || '' %>" 
                                                   placeholder="e.g. NPR 50,000 - 80,000 per month">
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Job Description -->
                            <div class="form-section">
                                <h5 class="section-title">
                                    <i class="fas fa-file-alt"></i>Job Description
                                </h5>
                                
                                <div class="mb-3">
                                    <label for="description" class="form-label">
                                        Job Description <span class="required">*</span>
                                    </label>
                                    <textarea class="form-control" id="description" name="description" 
                                              rows="8" required placeholder="Describe the role, responsibilities, company culture, and what makes this opportunity exciting. Be detailed and engaging to attract the right candidates..."><%= formData.description || '' %></textarea>
                                    <div class="character-counter" id="descriptionCounter">0 characters</div>
                                </div>

                                <div class="mb-3">
                                    <label for="requirements" class="form-label">
                                        <i class="fas fa-list-check me-1"></i>
                                        Requirements & Qualifications
                                    </label>
                                    <textarea class="form-control" id="requirements" name="requirements" 
                                              rows="6" placeholder="List the required skills, experience, education, and qualifications. Include both must-have and nice-to-have requirements..."><%= formData.requirements || '' %></textarea>
                                    <div class="character-counter" id="requirementsCounter">0 characters</div>
                                </div>
                            </div>

                            <!-- Form Actions -->
                            <div class="form-actions">
                                <div class="d-flex justify-content-between align-items-center flex-wrap gap-3">
                                    <a href="/company/dashboard" class="btn btn-secondary">
                                        <i class="fas fa-arrow-left me-2"></i>Back to Dashboard
                                    </a>
                                    <div class="d-flex gap-3">
                                        <button type="button" class="btn btn-primary" onclick="previewJob()">
                                            <i class="fas fa-eye me-2"></i>Preview Job
                                        </button>
                                        <button type="submit" class="btn btn-success">
                                            <i class="fas fa-rocket me-2"></i>Publish Job
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Floating Help Button -->
    <button class="floating-help" onclick="showHelp()">
        <i class="fas fa-question-circle me-2"></i>Need Help?
    </button>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Character counters
        function updateCharacterCounter(textareaId, counterId) {
            const textarea = document.getElementById(textareaId);
            const counter = document.getElementById(counterId);
            
            textarea.addEventListener('input', function() {
                const length = this.value.length;
                counter.textContent = `${length} characters`;
                
                if (length < 50) {
                    counter.style.color = '#e74c3c';
                } else if (length < 200) {
                    counter.style.color = '#f39c12';
                } else {
                    counter.style.color = '#27ae60';
                }
            });
            
            // Initial count
            textarea.dispatchEvent(new Event('input'));
        }

        updateCharacterCounter('description', 'descriptionCounter');
        updateCharacterCounter('requirements', 'requirementsCounter');

        // Form validation
        document.getElementById('jobForm').addEventListener('submit', function(e) {
            const title = document.getElementById('title').value.trim();
            const description = document.getElementById('description').value.trim();
            const location = document.getElementById('location').value.trim();
            const jobType = document.querySelector('input[name="job_type"]:checked');

            if (!title || !description || !location || !jobType) {
                e.preventDefault();
                alert('Please fill in all required fields marked with *');
                return;
            }

            if (description.length < 50) {
                e.preventDefault();
                alert('Job description should be at least 50 characters long to attract quality candidates.');
                return;
            }

            // Show loading state
            const submitBtn = this.querySelector('button[type="submit"]');
            const originalText = submitBtn.innerHTML;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Publishing Job...';
            submitBtn.disabled = true;
            
            // Re-enable if there's an error (page doesn't redirect)
            setTimeout(() => {
                submitBtn.innerHTML = originalText;
                submitBtn.disabled = false;
            }, 5000);
        });

        // Preview job function
        function previewJob() {
            const title = document.getElementById('title').value || 'Job Title';
            const description = document.getElementById('description').value || 'Job description will appear here...';
            const location = document.getElementById('location').value || 'Location';
            const salary = document.getElementById('salary_range').value || 'Salary not specified';
            const jobType = document.querySelector('input[name="job_type"]:checked');
            const jobTypeText = jobType ? jobType.nextElementSibling.textContent.trim() : 'Job Type';

            const previewContent = `
                <div style="font-family: 'Poppins', sans-serif; max-width: 600px; margin: 0 auto; padding: 2rem; background: white; border-radius: 15px;">
                    <h2 style="color: #667eea; margin-bottom: 1rem;">${title}</h2>
                    <div style="margin-bottom: 1rem;">
                        <span style="background: #667eea; color: white; padding: 0.5rem 1rem; border-radius: 20px; font-size: 0.8rem;">${jobTypeText}</span>
                    </div>
                    <p style="margin-bottom: 0.5rem;"><strong>üìç Location:</strong> ${location}</p>
                    <p style="margin-bottom: 1rem;"><strong>üí∞ Salary:</strong> ${salary}</p>
                    <div style="background: #f8f9ff; padding: 1rem; border-radius: 10px; margin-bottom: 1rem;">
                        <h4 style="color: #667eea;">Job Description</h4>
                        <p style="line-height: 1.6;">${description}</p>
                    </div>
                    <p style="text-align: center; color: #6c757d; font-style: italic;">This is how your job will appear to candidates</p>
                </div>
            `;

            const previewWindow = window.open('', '_blank', 'width=800,height=600,scrollbars=yes');
            previewWindow.document.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Job Preview - ${title}</title>
                    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
                </head>
                <body style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); margin: 0; padding: 2rem;">
                    ${previewContent}
                </body>
                </html>
            `);
            previewWindow.document.close();
        }

        // Help function
        function showHelp() {
            alert(`üìù Job Posting Tips:

‚úÖ Write a clear, descriptive job title
‚úÖ Include detailed job description (minimum 50 characters)
‚úÖ Specify location clearly (city, remote, hybrid)
‚úÖ Add salary range to attract more candidates
‚úÖ List both required and preferred qualifications
‚úÖ Mention company culture and benefits
‚úÖ Use keywords that candidates might search for

Need more help? Contact our support team!`);
        }

        // Auto-save draft (optional enhancement)
        let autoSaveTimer;
        document.querySelectorAll('input, textarea, select').forEach(field => {
            field.addEventListener('input', function() {
                clearTimeout(autoSaveTimer);
                autoSaveTimer = setTimeout(() => {
                    // Save draft to localStorage
                    const formData = new FormData(document.getElementById('jobForm'));
                    const draftData = {};
                    for (let [key, value] of formData.entries()) {
                        draftData[key] = value;
                    }
                    localStorage.setItem('jobDraft', JSON.stringify(draftData));
                    
                    // Show saved indicator
                    const indicator = document.createElement('div');
                    indicator.textContent = '‚úÖ Draft saved';
                    indicator.style.cssText = 'position: fixed; top: 20px; right: 20px; background: #00b894; color: white; padding: 0.5rem 1rem; border-radius: 25px; font-size: 0.8rem; z-index: 9999;';
                    document.body.appendChild(indicator);
                    
                    setTimeout(() => {
                        indicator.remove();
                    }, 2000);
                }, 2000);
            });
        });

        // Load draft on page load
        document.addEventListener('DOMContentLoaded', function() {
            const savedDraft = localStorage.getItem('jobDraft');
            if (savedDraft && confirm('We found a saved draft. Would you like to restore it?')) {
                const draftData = JSON.parse(savedDraft);
                Object.keys(draftData).forEach(key => {
                    const field = document.querySelector(`[name="${key}"]`);
                    if (field) {
                        if (field.type === 'radio') {
                            const radioField = document.querySelector(`[name="${key}"][value="${draftData[key]}"]`);
                            if (radioField) radioField.checked = true;
                        } else {
                            field.value = draftData[key];
                        }
                    }
                });
                
                // Update character counters
                document.getElementById('description').dispatchEvent(new Event('input'));
                document.getElementById('requirements').dispatchEvent(new Event('input'));
            }
        });
    </script>
</body>
</html>
