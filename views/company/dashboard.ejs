<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Company Dashboard - Elevate Workforce Solutions</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 25%, #f093fb 50%, #f5576c 75%, #4facfe 100%);
            min-height: 100vh;
            font-family: 'Poppins', sans-serif;
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 20%, rgba(102, 126, 234, 0.2) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(245, 87, 108, 0.2) 0%, transparent 50%),
                radial-gradient(circle at 40% 60%, rgba(79, 172, 254, 0.15) 0%, transparent 50%);
            animation: backgroundPulse 8s ease-in-out infinite;
            z-index: -1;
        }

        @keyframes backgroundPulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.8; transform: scale(1.05); }
        }

        .navbar {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
            backdrop-filter: blur(20px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            padding: 1rem 0;
        }

        .navbar-brand {
            font-weight: 700;
            font-size: 1.8rem;
            color: #fff !important;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .nav-link {
            color: rgba(255, 255, 255, 0.9) !important;
            font-weight: 500;
            margin: 0 0.5rem;
            padding: 0.5rem 1rem !important;
            border-radius: 25px;
            transition: all 0.3s ease;
        }

        .nav-link:hover, .nav-link.active {
            background: rgba(255, 255, 255, 0.2);
            color: #fff !important;
            transform: translateY(-2px);
        }

        .dashboard-header {
            text-align: center;
            padding: 2rem 0;
            margin-bottom: 2rem;
        }

        .dashboard-header h1 {
            font-size: 3rem;
            font-weight: 700;
            color: white;
            text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.3);
            margin-bottom: 0.5rem;
        }

        .dashboard-header p {
            font-size: 1.3rem;
            color: rgba(255, 255, 255, 0.9);
            font-weight: 500;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.2);
        }

        .stats-card {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.95) 0%, rgba(255, 255, 255, 0.85) 100%);
            backdrop-filter: blur(20px);
            border-radius: 25px;
            padding: 2rem;
            text-align: center;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            transition: all 0.4s ease;
            position: relative;
            overflow: hidden;
            margin-bottom: 2rem;
        }

        .stats-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: linear-gradient(90deg, #667eea, #764ba2, #f093fb, #f5576c);
        }

        .stats-card:hover {
            transform: translateY(-10px) scale(1.02);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
        }

        .stats-card.jobs {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .stats-card.active {
            background: linear-gradient(135deg, #00b894 0%, #00a085 100%);
            color: white;
        }

        .stats-card.applications {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }

        .stats-card.pending {
            background: linear-gradient(135deg, #fdcb6e 0%, #e17055 100%);
            color: white;
        }

        .stats-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.9;
        }

        .stats-number {
            font-size: 3rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
        }

        .stats-label {
            font-size: 1.1rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .card {
            border: none;
            border-radius: 25px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(20px);
            background: rgba(255, 255, 255, 0.95);
            transition: all 0.4s ease;
            overflow: hidden;
            position: relative;
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #667eea, #764ba2, #f093fb, #f5576c);
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
        }

        .card-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
            color: white;
            border: none;
            padding: 1.5rem;
            font-weight: 600;
        }

        .card-header h5 {
            font-size: 1.3rem;
            font-weight: 700;
            margin: 0;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            border-radius: 50px;
            padding: 10px 25px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.6);
            background: linear-gradient(135deg, #764ba2 0%, #667eea 100%);
        }

        .btn-success {
            background: linear-gradient(135deg, #00b894 0%, #00a085 100%);
            border: none;
            border-radius: 50px;
            padding: 10px 25px;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 184, 148, 0.4);
        }

        .btn-success:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0, 184, 148, 0.6);
        }

        .btn-outline-primary, .btn-outline-warning, .btn-outline-danger, .btn-outline-success {
            border-radius: 50px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn-outline-primary:hover, .btn-outline-warning:hover, 
        .btn-outline-danger:hover, .btn-outline-success:hover {
            transform: translateY(-2px);
        }

        .badge {
            border-radius: 50px;
            padding: 8px 15px;
            font-weight: 600;
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .badge.bg-info {
            background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%) !important;
        }

        .badge.bg-success {
            background: linear-gradient(135deg, #00b894 0%, #00a085 100%) !important;
        }

        .badge.bg-secondary {
            background: linear-gradient(135deg, #636e72 0%, #2d3436 100%) !important;
        }

        .badge.bg-warning {
            background: linear-gradient(135deg, #fdcb6e 0%, #e17055 100%) !important;
        }

        .badge.bg-danger {
            background: linear-gradient(135deg, #fd79a8 0%, #e84393 100%) !important;
        }

        .table {
            border-radius: 15px;
            overflow: hidden;
        }

        .table th {
            background: linear-gradient(135deg, #f8f9ff 0%, #fff5f5 100%);
            border: none;
            font-weight: 700;
            color: #495057;
            padding: 1rem;
        }

        .table td {
            border: none;
            padding: 1rem;
            vertical-align: middle;
        }

        .table tbody tr {
            transition: all 0.3s ease;
        }

        .table tbody tr:hover {
            background: linear-gradient(135deg, #f8f9ff 0%, #fff5f5 100%);
            transform: scale(1.01);
        }

        .empty-state {
            text-align: center;
            padding: 3rem;
            color: #6c757d;
        }

        .empty-state i {
            font-size: 4rem;
            margin-bottom: 1.5rem;
            opacity: 0.5;
        }

        .empty-state h5 {
            font-weight: 700;
            margin-bottom: 1rem;
            color: #495057;
        }

        .application-item {
            background: linear-gradient(135deg, #f8f9ff 0%, #fff5f5 100%);
            border-radius: 15px;
            padding: 1rem;
            margin-bottom: 1rem;
            transition: all 0.3s ease;
            border-left: 4px solid #667eea;
        }

        .application-item:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .alert {
            border: none;
            border-radius: 15px;
            padding: 1rem 1.5rem;
            font-weight: 500;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            animation: slideIn 0.5s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .alert-success {
            background: linear-gradient(135deg, #00b894 0%, #00a085 100%);
            color: white;
        }

        .floating-action {
            position: fixed;
            bottom: 30px;
            right: 30px;
            z-index: 1000;
            border-radius: 50px;
            padding: 15px 25px;
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
            animation: bounce 2s infinite;
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            60% { transform: translateY(-5px); }
        }

        @media (max-width: 768px) {
            .dashboard-header h1 {
                font-size: 2rem;
            }
            
            .dashboard-header p {
                font-size: 1rem;
            }
            
            .stats-card {
                margin-bottom: 1rem;
            }
            
            .floating-action {
                bottom: 20px;
                right: 20px;
                padding: 12px 20px;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
        <div class="container">
            <a class="navbar-brand" href="/jobs">
                <i class="fas fa-briefcase me-2"></i>Elevate Workforce
            </a>
            
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="/jobs">
                            <i class="fas fa-search me-1"></i>Browse Jobs
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="/company/dashboard">
                            <i class="fas fa-tachometer-alt me-1"></i>Dashboard
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/company/jobs/create">
                            <i class="fas fa-plus me-1"></i>Post Job
                        </a>
                    </li>
                </ul>
                
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" href="/auth/logout">
                            <i class="fas fa-user me-1"></i><%= user.name %> - Logout
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container" style="margin-top: 100px;">
        <!-- Dashboard Header -->
        <div class="dashboard-header">
            <h1><i class="fas fa-tachometer-alt me-3"></i>Company Dashboard</h1>
            <p>Welcome back, <strong><%= user.company_name %></strong>! Manage your jobs and applications</p>
        </div>

        <!-- Success Message -->
        <% if (message) { %>
            <div class="alert alert-success alert-dismissible fade show">
                <i class="fas fa-check-circle me-2"></i><%= message %>
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>
        <% } %>

        <!-- Statistics Cards -->
        <div class="row mb-5">
            <div class="col-md-3">
                <div class="stats-card jobs">
                    <i class="fas fa-briefcase stats-icon"></i>
                    <div class="stats-number"><%= stats.totalJobs %></div>
                    <div class="stats-label">Total Jobs</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stats-card active">
                    <i class="fas fa-eye stats-icon"></i>
                    <div class="stats-number"><%= stats.activeJobs %></div>
                    <div class="stats-label">Active Jobs</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stats-card applications">
                    <i class="fas fa-file-alt stats-icon"></i>
                    <div class="stats-number"><%= stats.totalApplications %></div>
                    <div class="stats-label">Applications</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stats-card pending">
                    <i class="fas fa-clock stats-icon"></i>
                    <div class="stats-number"><%= stats.pendingApplications %></div>
                    <div class="stats-label">Pending Reviews</div>
                </div>
            </div>
        </div>

        <div class="row">
            <!-- Jobs Management -->
            <div class="col-lg-8">
                <div class="card">
                    <div class="card-header">
                        <div class="d-flex justify-content-between align-items-center">
                            <h5><i class="fas fa-briefcase me-2"></i>Your Job Listings</h5>
                            <a href="/company/jobs/create" class="btn btn-light btn-sm">
                                <i class="fas fa-plus me-1"></i>Post New Job
                            </a>
                        </div>
                    </div>
                    <div class="card-body">
                        <% if (jobs.length === 0) { %>
                            <div class="empty-state">
                                <i class="fas fa-briefcase"></i>
                                <h5>No Jobs Posted Yet</h5>
                                <p class="text-muted">Start building your team by posting your first job listing</p>
                                <a href="/company/jobs/create" class="btn btn-primary btn-lg">
                                    <i class="fas fa-rocket me-2"></i>Post Your First Job
                                </a>
                            </div>
                        <% } else { %>
                            <div class="table-responsive">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th><i class="fas fa-briefcase me-1"></i>Job Title</th>
                                            <th><i class="fas fa-map-marker-alt me-1"></i>Location</th>
                                            <th><i class="fas fa-tag me-1"></i>Type</th>
                                            <th><i class="fas fa-toggle-on me-1"></i>Status</th>
                                            <th><i class="fas fa-calendar me-1"></i>Posted</th>
                                            <th><i class="fas fa-cogs me-1"></i>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <% jobs.forEach(job => { %>
                                            <tr>
                                                <td>
                                                    <strong class="text-primary"><%= job.title %></strong>
                                                </td>
                                                <td><%= job.location %></td>
                                                <td>
                                                    <span class="badge bg-info">
                                                        <%= job.job_type.replace('_', ' ').toUpperCase() %>
                                                    </span>
                                                </td>
                                                <td>
                                                    <span class="badge <%= job.status === 'active' ? 'bg-success' : 'bg-secondary' %>">
                                                        <%= job.status.toUpperCase() %>
                                                    </span>
                                                </td>
                                                <td>
                                                    <%= new Date(job.created_at).toLocaleDateString('en-US', { 
                                                        month: 'short', 
                                                        day: 'numeric' 
                                                    }) %>
                                                </td>
                                                <td>
                                                    <div class="btn-group btn-group-sm">
                                                        <a href="/jobs/<%= job.id %>" class="btn btn-outline-primary" title="View Job">
                                                            <i class="fas fa-eye"></i>
                                                        </a>
                                                        <a href="/company/jobs/<%= job.id %>/edit" class="btn btn-outline-warning" title="Edit Job">
                                                            <i class="fas fa-edit"></i>
                                                        </a>
                                                        <button class="btn btn-outline-danger" onclick="deleteJob(<%= job.id %>)" title="Delete Job">
                                                            <i class="fas fa-trash"></i>
                                                        </button>
                                                    </div>
                                                </td>
                                            </tr>
                                        <% }); %>
                                    </tbody>
                                </table>
                            </div>
                        <% } %>
                    </div>
                </div>
            </div>

            <!-- Recent Applications -->
            <div class="col-lg-4">
                <div class="card">
                    <div class="card-header" style="background: linear-gradient(135deg, #00b894 0%, #00a085 100%) !important;">
                        <h5><i class="fas fa-file-alt me-2"></i>Recent Applications</h5>
                    </div>
                    <div class="card-body">
                        <% if (applications.length === 0) { %>
                            <div class="empty-state">
                                <i class="fas fa-file-alt"></i>
                                <h6>No Applications Yet</h6>
                                <p class="text-muted small">Applications will appear here when candidates apply to your jobs</p>
                            </div>
                        <% } else { %>
                            <% applications.slice(0, 5).forEach(app => { %>
                                <div class="application-item">
                                    <div class="d-flex justify-content-between align-items-start">
                                        <div class="flex-grow-1">
                                            <strong class="d-block text-primary"><%= app.applicant_name %></strong>
                                            <small class="text-muted">Applied for: <%= app.job_title %></small>
                                            <div class="mt-2">
                                                <span class="badge <%= app.status === 'pending' ? 'bg-warning' : app.status === 'accepted' ? 'bg-success' : app.status === 'rejected' ? 'bg-danger' : 'bg-info' %>">
                                                    <%= app.status.toUpperCase() %>
                                                </span>
                                            </div>
                                        </div>
                                        <div class="btn-group btn-group-sm">
                                            <button class="btn btn-outline-success" onclick="updateApplicationStatus(<%= app.id %>, 'accepted')" title="Accept Application">
                                                <i class="fas fa-check"></i>
                                            </button>
                                            <button class="btn btn-outline-danger" onclick="updateApplicationStatus(<%= app.id %>, 'rejected')" title="Reject Application">
                                                <i class="fas fa-times"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            <% }); %>
                            
                            <% if (applications.length > 5) { %>
                                <div class="text-center mt-3">
                                    <small class="text-muted">
                                        <i class="fas fa-plus-circle me-1"></i>
                                        And <%= applications.length - 5 %> more applications...
                                    </small>
                                </div>
                            <% } %>
                        <% } %>
                    </div>
                </div>

                <!-- Quick Actions Card -->
                <div class="card mt-4">
                    <div class="card-header" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%) !important;">
                        <h5><i class="fas fa-bolt me-2"></i>Quick Actions</h5>
                    </div>
                    <div class="card-body">
                        <div class="d-grid gap-2">
                            <a href="/company/jobs/create" class="btn btn-primary">
                                <i class="fas fa-plus me-2"></i>Post New Job
                            </a>
                            <a href="/jobs" class="btn btn-outline-primary">
                                <i class="fas fa-search me-2"></i>Browse All Jobs
                            </a>
                            <button class="btn btn-outline-success" onclick="window.print()">
                                <i class="fas fa-print me-2"></i>Print Report
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Floating Action Button -->
    <a href="/company/jobs/create" class="btn btn-primary floating-action">
        <i class="fas fa-plus me-2"></i>Post Job
    </a>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        async function deleteJob(jobId) {
            if (!confirm('Are you sure you want to delete this job? This action cannot be undone and will remove all associated applications.')) {
                return;
            }
            
            try {
                const response = await fetch(`/company/jobs/${jobId}`, {
                    method: 'DELETE'
                });
                
                const result = await response.json();
                
                if (result.success) {
                    // Show success animation
                    const row = event.target.closest('tr');
                    row.style.background = 'linear-gradient(135deg, #00b894 0%, #00a085 100%)';
                    row.style.color = 'white';
                    row.style.transform = 'scale(0.95)';
                    
                    setTimeout(() => {
                        window.location.reload();
                    }, 1000);
                } else {
                    alert(result.message || 'Failed to delete job');
                }
            } catch (error) {
                console.error('Error:', error);
                alert('An error occurred while deleting the job');
            }
        }

        async function updateApplicationStatus(applicationId, status) {
            try {
                const response = await fetch(`/applications/${applicationId}/status`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ status })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    // Show success animation
                    const applicationItem = event.target.closest('.application-item');
                    applicationItem.style.background = status === 'accepted' ? 
                        'linear-gradient(135deg, #00b894 0%, #00a085 100%)' : 
                        'linear-gradient(135deg, #fd79a8 0%, #e84393 100%)';
                    applicationItem.style.color = 'white';
                    applicationItem.style.transform = 'scale(1.02)';
                    
                    setTimeout(() => {
                        window.location.reload();
                    }, 1500);
                } else {
                    alert(result.message || 'Failed to update application status');
                }
            } catch (error) {
                console.error('Error:', error);
                alert('An error occurred while updating the application status');
            }
        }

        // Add hover effects to stats cards
        document.querySelectorAll('.stats-card').forEach(card => {
            card.addEventListener('mouseenter', function() {
                this.style.transform = 'translateY(-10px) scale(1.02)';
            });
            
            card.addEventListener('mouseleave', function() {
                this.style.transform = 'translateY(0) scale(1)';
            });
        });

        // Auto-dismiss alerts
        setTimeout(() => {
            document.querySelectorAll('.alert').forEach(alert => {
                if (alert.classList.contains('show')) {
                    alert.classList.remove('show');
                    setTimeout(() => alert.remove(), 300);
                }
            });
        }, 5000);

        // Add loading states to buttons
        document.querySelectorAll('button').forEach(button => {
            button.addEventListener('click', function() {
                if (this.type !== 'button') return;
                
                const originalText = this.innerHTML;
                this.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Processing...';
                this.disabled = true;
                
                setTimeout(() => {
                    this.innerHTML = originalText;
                    this.disabled = false;
                }, 2000);
            });
        });

        // Animate numbers on page load
        document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('.stats-number').forEach(number => {
                const finalValue = parseInt(number.textContent);
                let currentValue = 0;
                const increment = finalValue / 50;
                
                const timer = setInterval(() => {
                    currentValue += increment;
                    if (currentValue >= finalValue) {
                        number.textContent = finalValue;
                        clearInterval(timer);
                    } else {
                        number.textContent = Math.floor(currentValue);
                    }
                }, 30);
            });
        });
    </script>
</body>
</html>
